\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{titlesec}
\setcounter{secnumdepth}{4}

\usepackage{geometry}
\geometry{legalpaper, margin=0.8in}

\renewcommand{\baselinestretch}{1.5} 

\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\title{Rapport M2 Rémi Legrand}
\author{Rémi Legrand}
\date{May 2024}

\begin{document}

\maketitle

\section{Rapide résumé  (futur abstract)}

En se basant sur une méthode développée par Lisa Nickvert et Stéphane dray, il est possible de déterminer les traits lattent des espèces à partir d'un réseau d'interactions grâce à une méthode statistique (AFC/ Correspondance Analysis) qui permet de faire fi des abondances (effet neutre/ champ moyen) et de décomposer le réseau en une série d'axes orthogonaux qui organisent l'information. C'est à dire les traits latents.
Cette méthode, basée sur la décomposition en valeur singulières (SVD) est pratique vu qu'elle permet d'obtenir des axes indépendants et de retirer l'effet des abondance grâce à une "normalisation avec $\chi^2$.

Cependant, bien que cela fonctionne sur des réseaux uniques, est-il possible de faire la même chose sur des séries de réseaux et est ce que la performance augmenterais vu que l'on a une description plus fine et globale du réseau ou est ce que elle diminue vu que l'on pourrait avoir une variabilité trop importante entre les sites et il ne serais plus possible de trouver les axes organisateur de l'ensemble des données mais de chaque sous jeu de données.
Et serait il possible de détecter un des termes récurent dans les analyse de réseaux écologique sur le quel il n'y a pas de consensus: le rewiring?

Rewiring: la modification des interactions entre espèces présentes dans plusieurs sites

En effet, nous appliquons l'AFC sur les tableaux agrégés afin d'obtenir les axes organisateurs du réseau puis après, nous nous attendons à ce ces modification d'interaction entraîne des changements de positons quand on projette un sous-réseau sur les axes obtenus et ainsi que les espèce qui ont une variation de position importante soient des espèce qui ont des "rôles" différents entre les différents sous réseaux et ainsi qu'elles aient des modification de leurs interactions entre plusieurs sites.

Afin de bien controller et de connaitre les paramètre sous jacent, les données sont simulée à partir d'abondances et de probabilité d'interaction entre espèce selon le  

\section{Introduction}

\begin{itemize}
    \item relier au climate change avec les notions de shift de niches
    \item define niche de grinnel, elton (hutchinson) realized and fundamental
    \begin{itemize}
        \item \underline{Grinellian niche:} the niche of the species is determined by the habitat in which it lives and its accompanying behavioural modification. It can be defined by abiotic variables and environmental conditions on broad scale.
        \item \underline{Eltonian niche:} "The niche of an animal means its place in the biotic environment, its relations to food and enemies"
        \item classified niches according to foraging activities.
        \item response to and effect on the environment
        \item \underline{Hutchinsonian niche:} is a n-dimensional hyper-volume
    \end{itemize}
    \item rewiring
    \begin{itemize}
        \item The beta diversity such as defined by Poisot in Poisot 2012 is a metric used to quantify the network  dissimilarity into species turnover and interaction turnover, also called rewiring.
    \end{itemize}
    \item trait matching
        \item what is trait matching
        \item how do we quantify it?
    \item introduce what we are going to do
\end{itemize}










\section{Methods}

\subsection{Network notations}
Let's consider a location and the resulting interactions of this sampling. We consider a bipartite network with r resources species and c consumer species. In this case, the resources and consumer doesn't imply a prédation. It can either be plant/pollinators, host/parasitism, or else as long as the network is bipartite. 

Let $Y$ be the $r\times c$ matrix of interactions such that $\textrm{Y} = [y_{ij}]$. With $y_{ij}$ the number interactions between i and j observed.
Let $\textrm{P}=[\frac{y_{ij}}{y_{++}}]$

$r=\textrm{P1}_r =[p_{1+}, ..., p_{r+}]^\intercal$

$c=\textrm{P1}_c=[p_{+1}, ..., p_{+c}]^\intercal$

$y_{++}=\sum_{i=1}^{r}\sum_{j=1}^{c}y_{ij}$

$p_{i+}=\sum_{j=1}^{c}$ and $p_{+j}=\sum_{i=1}^{r}$ are the marginal sums for rows and columns.














\subsection{Simulation}

based on Fründ et al 2016, Benadi et al 2022, Dray and Legrendre 2008 as well as the thesis of Lisa Nickvert

\subsubsection{Assumptions}
Here, we assume that the proxi of the relative abundances is is the frequency of the observed interaction for a given specie. We as well assume that the interactions are solely based on a mixed effect of the trait matching and of the abundance. We can be understood as the probability of two species encountering, which is the product of the abundances, time the probability of these two species interaction together based on their trait matching.

Also, using a bipartite network assume that there is no interaction intra-group but only inter-groups. It implies that the competition, facilitation, spatial exclusion.




\subsubsection{a) Traits generation}
Let $\textrm{T}^c = [t^c_{jk}]$ $(c \times 2)$ contains the parameters for the distribution of the consumers' traits. 
Let $\textrm{T}^r = [t^r_{jk}]$ $(r \times 2)$ contains the parameters for the distribution of the resources' traits. 

The first mean of the trait is uniformly distributed between 0 and 1 for both consumers and resources and for the second trait, the span of the gradient is smaller such that it has less weight in driving the matching. 
For the consumer we associate a variance to the distribution in addition to an optimum in order to give a notion of specialisation of the consumers.

The trait matching doesn't have to be something well defined like the length of the beak on the size of the fruit. First of all, it is most likely that the traits found are a combination of multiples pondered traits that can include more subjective thing as the taste for example that can be though of as a gradient of sour/sweetness of the fruit or plant.
The variability/ tolerance is encoded as the variance and the optimum is the mean of the distribution.

The traits PDF follows a normal distribution whose means are uniformly distributed between 0 and 1 and the variance follow a normal distribution.




\subsubsection{b) Interaction probability based on trait matching}
Then we compute the interaction probability  solely based on the trait matching. To do so, we assume that the consumers interaction niche defined by the traits follow a bivariate normal distribution. Hence the probability of the the species i and j interacting follows the is influenced by the distance of the resource optimum to the consumer optimum and the tolerance of the consumer:

$$\textbf{M} = [m_{ij}]=\frac{1}{2\pi s_{j1}s_{j2}} \textbf{exp}\left(-\frac{(t^c_{j1} - t^r_{i1})^2}{2s^2_{j1}} - \frac{(t^c_{j2} - t^r_{i2})^2}{2s^2_{j2}}\right)$$
Cependant ici on dirait que ce n'est que la pdf de la fonction normale de l'un $\times$ celui de l'autre, je ne sais pas si c'est bien ça.




\subsubsection{c) Abundances and environmental distribution}
Here we use the Hutchinsonian definition of the niche as a position of the species in a 1 dimensional gradient.

Here, we assume that the species are normally distributed across an environmental gradient. This gradient can either represent the distribution over time or the distribution across space, for example in the case of a mountain. As for the traits, this gradients may takes in account different factors such as the humidity, sun exposure, temperature, altitude, soil, etc in the case of the space gradient.
Here we assume normality distribution, which imply a unique associated optimum as well as a tolerance expressed as a variance. Let then define $\textbf{E}^r$ and $\textbf{E}^c$ the two matrices containing the environmental optimums that are uniformly distributed and the environmental tolerances.

Depending on the position of the frames we compute the number of individuals seen in the observed quadrat. We assume that the abundance/theoretical number of individuals is given by the density of the Probability density function times a number to approximate the population size. We then assume that there is a certain probability of observing the specie and hence we use a Poisson process to estimate the number of time the specie is observed during the time of the observation.


\subsubsection{d) Interaction probability based on population size}
We consider that the species have a certain that the number of potential interactions is proportional to the number of individuals and hence we multiply for each network the population size of both consumers and resources. (same principles and for concentration of chemical when there is a reaction)
Hence we define $\textbf{A} = a_{ij} = a^r a^{c\intercal}$




\subsubsection{e) Integration of the trait matching and mean field}
Let's define $\textbf{P}^*$ the $i \times j$ matrix such that $\textbf{P}^* = p^*_{ij} = \frac{{m_{i\mid j}}^\delta a_{ij}}{a_{++}^*}$ with delta a variable to ponder the weight given to the trait matching in comparison to the neutral effect.
It corresponds to the the number of observation we can expect to have during the observation period.




\subsubsection{f) Sampling of the interactions based on the previous computed probability}
Let's now introduce the observation bias and the sampling force. In order to take in account the sampling effort over the site, we sample a number ninter of observations using the $\textbf{P}^*$ matrix. To do so, we sample using a multinomial distribution with $k = r \times c$ outcomes corresponding to all the possible combination of possible interactions. The probability matrix is used is $\textbf{P}^*$.

The interaction counts are defined in the matrix $\textbf{Z}$











\subsection{SVD and correspondance analysis}

\subsubsection{What is an SVD}

The regular diagonalization of a rectangular matrix $A$ of size $n \times m$ by $X^{-1} AX$ the resulting eigenvectors in X will not always be orthogonal, it requires to have a matrix $A$ a square matrix to have $Ax = \lambda x$. Also we have not always enough eigenvalues (apparently, but I don't really get what this means and why).

The singular value decomposition methods enable to diagonalize a rectangular matrix $A$ of size $n \times m$ in two sets of singular vectors, u's and v's. 
$u's \in \mathbb{R}^m$ and $u's \in \mathbb{R}^n$ will be in a $m \times m$ U matrix and a $n \times n$ V matrix

$A = U \Sigma V^\intercal$
$\Leftrightarrow A = \sum_i \sigma_i U_i \otimes V_i^\intercal$
the  $\Sigma$ matrix contains only values on the diagonal and contains the $\sigma$ values that are analogous to the eigenvalues 
We call U the left singular vector and V the right singular vector of $\sigma$
the diagonal entries $\sigma_i = \Sigma_{ii}$ of $\Sigma$ are uniquely determined by $M$ and known as singular values of $M$. The number non 0 singular values is equal to the rank of the matrix $M$.

\subsubsection{Interpretation of the meaning of each matrices of the SVD}

$V^\intercal$ corresponds to a rotation on the unit disc, $\Sigma$ corresponds to a  scaling on the different dimensions, and $U$ to an other rotation 

\subsubsection{Why we are interested in SVD}

SVD enables to obtain a sum of the vector product of rank one matrices, enabling to approximate more and more accurately the origin matrix. Therefore, when we have a matrix made of a Sum of clear signal and noise, we can filter out the noise by selecting the biggest $\sigma$ values as it will constitue the ordered information of the matrix and then there should be something something analog to an eigengap and the rest of the small $\sigma$ are noise.

In the case where the organized information is a sum of products of vectors, it would even be possible to retrieve theses vectors up to a rotation, as long as these are orthogonal.

Also, the regular SVD considers 0 as information whereas in our case, it is rather an absence of information, and that's one of the main reasons for using CA

\subsubsection{Correspondence Analysis}

\paragraph{1: Contribution to $\chi^2$}

contingency table transformed into a contribution table by a poisson $\chi^2$ 
$\chi^2 = \frac{O_{ij} -  E_{ij}}{\sqrt{E_{ij}}} = \sqrt{f_{++}}[\frac{p_{ij} - p_{i+}p_{+j}}{\sqrt{p_{i+}p_{+j}}}]$

$\overline{Q} = [\overline{q}_{ij}] = [\frac{p_{ij} - p_{i+}p_{+j}}{\sqrt{p_{i+}p_{+j}}}] = \frac{\chi_{ij}}{\sqrt{f_{++}}}$

\paragraph{SVD}

Singular value decomposition on the matrix $\overline{Q} = U_{(r\times c)} \Sigma_{(diagonal, c\times c)} V_{(c \times c)}^T$ 
$U$ and $V$ are both column orthogonal matrices and $\Sigma$ is a diagonal matrix $D_{\sigma_i}$ with $\sigma_i \in \mathbb{R}^+$ which are the singular values of $\overline{Q}$


\paragraph{eigen analysis}

\paragraph{comments (to remove later)}
Conceptually similar to Principal Component Analysis, but applies to categorical data rather than continuous data

CA has to be applied to a contingency matrix whereas SVD can be applied to any matrix

\subsection{Analysis}

\subsubsection{packages used}

\subsubsection{Trait matching reconstruction principle}

\subsubsection{Evaluate reconstruction}

Show the correlation between the 

\subsubsection{Rewiring estimation}

\section{Discussion}

The absence of correlation with the method of Toju et al is not a finality on it's own, as the way of computing it is not so clean and the current gold standard metric is the beta diversity for the turnover of the interactions. However, the way of computing the $\beta_{rewiring}$ diversity is based on the fact that the specie is present in one frame and not in the other. Therefore it only takes in account the species disappearance and is ignoring the fluctuations in abundances that do not lead to the absence of interactions. Hence there are many species that are accounted in species turnover, greatly under estimating the portion of the beta diversity due to rewiring. Likewise, we think that the proportion due to rewiring (turnover of the interactions) is over estimated.

This is due to the fact that the easiest proxy for the abundances to obtain. However, with the AFC, we can estimate the relative abundances assuming that the abundance for one specie is proportional to the number of interaction of this specie.

The downsides are that first, this hypothesis may overestimate/underestimate the abundances of the species depending of if these are in an extremity of the environmental gradient.

One of the other downsides is that we lost the information of the proportion of the beta dissimilarity due to rewiring and species turnover. 

One of our hypothesis was that the rewiring as we think about it right now is only an effect of the abundances variation as well as a strong sampling bias.





\section{Appendices}



\section{Package}



\section{Ecology}



\end{document}
